<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
	SQL File Name : board_BoardDAO_sql.xml
	Description : 게시판 화면 데이터를 관리한다.(조회, 등록, 수정, 삭제)
	author sgyoon
	since 2020. 09. 03.
-->
<mapper namespace="hae.basic.board.dao.BoardDAO">

	<resultMap id="board" type="hae.basic.board.model.Board">
		<result property="id" column="id"/>
		<result property="category" column="category"/>
		<result property="title" column="title"/>
		<result property="description" column="description"/>
		<result property="regUser" column="reg_user"/>
		<result property="regDate" column="reg_date"/>
		<result property="viewCount" column="view_count"/>
	</resultMap>

    <!--
        Query ID : selectBoardList
        Description : BOARD 테이블의 목록을 조회한다.
     -->
    <select id="selectBoardList" parameterType="hae.basic.board.model.Board" resultMap="board">
	<![CDATA[
		SELECT /* Query ID=hae.basic.board.service.dao.BoardDAO.selectBoardList */
			ID
			, CATEGORY
			, TITLE
			, REG_USER
			, REG_DATE
			, VIEW_COUNT
		FROM BOARD
		WHERE 1=1
	]]>
		<if test="searchKeyword != null and searchKeyword != ''">
	        <choose>
	            <when test="searchCondition == 0">
					AND	CATEGORY LIKE '%' || #{searchKeyword} || '%'
				</when>
	            <when test="searchCondition == 1">
					AND	TITLE LIKE '%' || #{searchKeyword} || '%'
				</when>
				<when test="searchCondition == 2">
					AND	REG_USER LIKE '%' || #{searchKeyword} || '%'
				</when>
				<when test="searchCondition == 3">
					AND	DESCRIPTION LIKE '%' || #{searchKeyword} || '%'
				</when>
			</choose>
		</if>
		ORDER BY ID DESC
    </select>

    <!--
        Query ID : selectBoardBySeq
        Description : seq를 검색조건으로 BOARD 테이블의 상세 정보 조회한다.
     -->
    <select id="selectBoardById" parameterType="able.cloud.core.vo.HMap" resultMap="board">
	<![CDATA[
		SELECT /* Query ID=hae.basic.board.service.dao.BoardDAO.selectBoardById */
			ID
			, CATEGORY
			, TITLE
			, DESCRIPTION
			, REG_USER
			, REG_DATE
		FROM BOARD
		WHERE ID = #{id}
	]]>
    </select>

    <!--
        Query ID : deleteBoard
        Description : seq 검색조건에 해당하는 데이터를 삭제한다.
     -->
    <delete id="deleteBoard" parameterType="hae.basic.board.model.Board">
        DELETE FROM BOARD
         WHERE ID = #{id}
    </delete>

    <!--
        Query ID : updateBoard
        Description : seq 검색조건에 해당하는 데이터를 수정한다.
     -->
    <update id="updateBoard" parameterType="able.cloud.core.vo.HMap">
	<![CDATA[
		UPDATE /* Query ID=hae.basic.board.service.dao.BoardDAO.updateBoard*/
			BOARD
		SET CATEGORY = #{category}
			, TITLE = #{title}
			, DESCRIPTION = #{description}
			, REG_USER = #{regUser}
	  	WHERE ID = #{id}
	]]>
    </update>

    <!--
        Query ID : insertBoard
        Description : BOARD 테이블에 데이터 입력
     -->
    <insert id="insertBoard" parameterType="hae.basic.board.model.Board">
    <![CDATA[
		INSERT /* Query ID=hae.basic.board.service.dao.BoardDAO.insertBoard*/
		INTO BOARD
			( CATEGORY
			  , TITLE
			  , DESCRIPTION
			  , REG_USER
			  , REG_DATE
			  , VIEW_COUNT )
		VALUES ( #{category}
			  , #{title}
			  , #{description}
			  , #{regUser}
			  , DATE_FORMAT(NOW(), '%Y-%m-%d')
			  , 0 )
    ]]>
    </insert>

	<!--
        Query ID : updateBoardViewCount
        Description : 게시글 조회시 조회수를 카운트 한다.
     -->
	<update id="updateBoardViewCount" parameterType="hae.basic.board.model.Board">
	<![CDATA[
		UPDATE /* Query ID=hae.basic.board.service.dao.BoardDAO.updateBoardViewCount */
			BOARD
		SET VIEW_COUNT = VIEW_COUNT+1
		WHERE ID = #{id}
	]]>
	</update>
</mapper>